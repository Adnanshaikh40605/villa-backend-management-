[build]
builder = "NIXPACKS"

[deploy]
# Start command runs migrations first, then creates superuser (if needed), collects static files, and starts gunicorn
startCommand = "python manage.py migrate && (python manage.py createsuperuser_production || echo 'Superuser creation skipped') && python manage.py collectstatic --noinput && gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --timeout 120 --workers 2"

# Healthcheck configuration
# Using /api/v1/ instead of /admin/ as it doesn't require authentication
healthcheckPath = "/api/v1/"
# Extended timeout to allow migrations to complete (especially with new schema changes)
healthcheckTimeout = 300
# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

